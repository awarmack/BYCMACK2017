"0","knitr::opts_chunk$set(echo=FALSE)"
"0","library(dplyr)"
"0","library(tidyr)"
"0","options(scipen=999)"
"0","getwd()"
"1","[1]"
"1"," ""C:/Users/AWarmack/Dropbox/projects/sailing/BYCMACK2017/analysis"""
"1","
"
"0","#Summarise by second, 5 seconds"
"0","rm(list=ls())"
"0","load(""../dat/alldat.RDATA"")"
"0","alldat$TIME.S <- as.POSIXct(round(alldat$TIME.S, ""secs""))"
"0","#summarise Performance Data by Minute"
"0","perf <- alldat %>% group_by(TIME.M) %>% summarise(SOG=mean(GPS.SOG, na.rm = TRUE), "
"0","                                                  AWS=mean(AWS, na.rm = TRUE), "
"0","                                                  AWA=mean(AWA, na.rm = TRUE), "
"0","                                                  COG=mean(GPS.COG, na.rm=TRUE), "
"0","                                                  LAT=mean(GGA.LAT, na.rm=TRUE),"
"0","                                                  LON=mean(GGA.LON, na.rm=TRUE))"
"0","#remove any over 180 and convert "
"0","perf$AWA[perf$AWA > 180] <- 360 - perf$AWA[perf$AWA > 180] "
"0","perf <- perf[perf$AWA > 0, ] "
"0","  #outputs a list with "
"0","  # $tws = True Wind Speed"
"0","  # $twa = True Wind Angle"
"0","  "
"0","  b <- AWA * (pi/180)"
"0","  "
"0","  #true wind speed"
"0","  TWS <- sqrt(AWS^2 + SOG^2 - 2*AWS*SOG*cos(b))"
"0","  "
"0","  "
"0","  calcTWA <- function(b, AWS.b, SOG.b, W){"
"0","    if(b > 0 & b<2*pi) {"
"0","      TWA <- acos(((AWS.b * cos(b)) - SOG.b)/W)"
"0","    } else {"
"0","      if(b > 2*pi) {"
"0","        TWA <- NA"
"0","      }"
"0","      TWA <- -acos(AWS.b * cos(b) - SOG.b)"
"0","    }"
"0","    if(!is.na(TWA)){"
"0","      TWA <- TWA*180/pi"
"0","    }"
"0","    return(TWA)"
"0","  }"
"0","  "
"0","  TWA <- mapply(FUN=calcTWA, b, AWS, SOG, TWS)"
"0","  x <- list(TWS=TWS, TWA=TWA)"
"0","  "
"0","  }"
"0","tw <- getTrueWind(perf$AWS, perf$AWA, perf$SOG)"
"0","perf$TWS <- tw$TWS"
"0","perf$TWA <- tw$TWA"
"0","#break wind speed into bins: "
"0","perf$AWS.range <- cut(perf$AWS, breaks=c(0, 6, 8, 10, 12, 16, 20, 24, 35))"
"0","perf$AWS.range <- factor(perf$AWS.range, levels=rev(levels(perf$AWS.range)))"
"0","perf$TWS.range <- cut(perf$TWS, breaks=c(0, 6, 8, 10, 12, 16, 20, 24, 35))"
"0","perf$TWS.range <- factor(perf$TWS.range, levels=rev(levels(perf$TWS.range)))"
"0","#break wind angle into bins:"
"0","perf$AWA.range <- cut(perf$AWA, breaks=seq(0,180, by=30))"
"0","perf$TWA.range <- cut(perf$AWA, breaks=seq(0,180, by=30))"
"0","getTWD <- function(TWA, COG){"
"0","  "
"0","  TWD <- COG + TWA"
"0","  "
"0","}"
