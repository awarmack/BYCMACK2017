{
    "collab_server" : "",
    "contents" : "##Read raw nmea data\n\nlibrary(stringr)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\n\nsource(\"./src/functions.R\")\n\n#Import raw csv file\nrawdat <- read.csv(\"./dat/datalog3\", header=FALSE, stringsAsFactors = FALSE)\n\n#Remove any rows where date column is screwed up\ndat <- rawdat[nchar(rawdat$V1)==26, ]  \n\n#extract the time\ntimest <- str_sub(dat$V1, start=4, end=16) \ntimest <- as.numeric(timest)  #adding 36 hrs\ntimest <- as.POSIXct(timest/1000, origin=\"1970-01-01\")\n\nst_time <- head(timest, 1)\nend_time <- tail(timest, 1)\n\n\n#adjust time using last GPS as actual\npitime <- as.POSIXct((1500743797513)/1000, origin=\"1970-01-01\", tz=\"UTC\")\nactual <- as.POSIXct(\"2017-07-24 07:14:20 UTC\", tz=\"UTC\")\ntdiff <- actual - pitime\ntimest <- timest + tdiff\n\ndat$timest <- timest\n\n#extract NMEA Headers\n\ndat$nmea <- str_extract(dat$V1, \"\\\\$.*\")\n\n\n#split into different frames\n\n#wind speed from Raymarine\nwind <- dat[dat$nmea ==\"$IIMWV\",]\nwind <- wind %>% select(nmea, timest, V2, V4) %>% rename(\"AWA\"=V2, \"AWS\"=V4)\nwind$AWA <- as.numeric(wind$AWA)\nwind$AWS <- as.numeric(wind$AWS)\nwind$AWS[wind$AWS > 100] <- NA  #set anything over 100 to NA\n\n#boat speed from Rawmarine                                                           \nstw <- dat[dat$nmea ==\"$IIVHW\", ]\nstw <- stw %>% select(nmea, timest, V6) %>% rename(\"stw\"=V6)\nstw$stw <- as.numeric(stw$stw)\nstw$stw[stw$stw > 13] <- NA\n\n#boat distance travelled from Raymarine\nvlw <- dat[dat$nmea == \"$IIVLW\", ]\nvlw <- vlw %>% select(nmea, timest, V2) %>% rename(\"cm.miles\"=V2)\nvlw$cm.miles <- as.numeric(vlw$cm.miles)\nvlw$cm.miles[vlw$cm.miles > 5220.3] <- NA\nvlw$cm.miles[vlw$cm.miles < 5069] <- NA\n\n#GPS bearing\ngpbod <- dat[dat$nmea==\"$GPBOD\",]\ngpbod <- gpbod %>% \n          select(nmea, timest, V2, V4, V6) %>% \n          rename(\"bear.true\"=V2, \"bear.mag\"=V4, \"waypt\" = V6) %>% \n          mutate(bear.true =as.numeric(bear.true), \n                 bear.mag = as.numeric(bear.mag))\n\n#GPS - Global Positioning System Fix Data\ngpgga <- dat[dat$nmea==\"$GPGGA\", ] %>% \n          select(nmea, timest, V2, V3, V4, V5, V6, V7, V8, V9, V10, V11, V12, V13) %>% \n          rename(\"time\"=V2, \n                 \"lat\"=V3,\n                 \"NS\"=V4,\n                 \"lon\"=V5,\n                 \"EW\"=V6,\n                 \"gps.qual\"=V7, \n                 \"no.sat\"=V8, \n                 \"prec\"=V9,\n                 \"ant.alt\"=V10,\n                 \"ant.alt.unit\"=V11,\n                 \"geo.sep\"=V12,\n                 \"geo.sep.unit\"=V13)\n\ngpgga$lat <- sapply(gpgga$lat, convCoord)  #convert to xx.xxxx format\ngpgga$lon <- sapply(gpgga$lon, convCoord)\ngpgga <- gpgga[gpgga$lat<47, ]             #remove outliers\ngpgga <- gpgga[gpgga$lon>80, ]             \ngpgga$lon <- gpgga$lon * -1                #change longitude to negative (for W)\n\ngpgga$ant.alt <- as.numeric(gpgga$ant.alt)  #conv altitude to number\ngpgga$ant.alt[gpgga$ant.alt>400] <- NA      #remove outliers\n\ngpgga$prec <- as.numeric(gpgga$prec)        #conv precision to number\n\n#Geographic Position\ngpgll <- dat[dat$nmea==\"$GPGLL\", ]\n\n\n\n\n\n\n",
    "created" : 1501633797485.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1718693849",
    "id" : "8FBE0291",
    "lastKnownWriteTime" : 1501634276,
    "last_content_update" : 1501634276158,
    "path" : "C:/Users/AWarmack/Dropbox/projects/sailing/BYCMACK2017/src/readNMEA (WarmackALT's conflicted copy 2017-08-01).R",
    "project_path" : "src/readNMEA (WarmackALT's conflicted copy 2017-08-01).R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}